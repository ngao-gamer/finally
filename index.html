<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #202020;
            --accent-color: white;
            --card-bg: rgba(15, 15, 15, 0.7);
            --text-color: rgba(255, 255, 255, 0.92);
            --border: rgba(255, 255, 255, 0.15);
            --success: #4CAF50;
            --danger: #f44336;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            font-weight: 600;
        }
        .tab.active {
            border-bottom-color: var(--accent-color);
            color: var(--accent-color);
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        #searchInput, select {
            padding: 10px;
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            color: var(--text-color);
            border-radius: var(--radius-md);
            transition: border-color 0.3s;
        }
        #searchInput {
            flex-grow: 1;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .script-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .script-card {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: var(--radius-md);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
        }
        .script-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }
        .script-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--danger);
            color: white;
            padding: 5px 10px;
            border-bottom-left-radius: var(--radius-md);
            font-size: 0.75rem;
            font-weight: bold;
            z-index: 10;
        }
        .script-image-container {
            width: 100%;
            height: 150px;
            overflow: hidden;
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
        }
        .script-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .script-title {
            font-size: 1.1rem;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .script-info {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        .script-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .empty-state {
            text-align: center;
            padding: 50px;
            grid-column: 1 / -1;
            color: var(--text-secondary);
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
        }
        .modal.active {
            display: block;
        }
        .modal-content {
            background-color: var(--bg-color);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid var(--border);
            width: 90%;
            max-width: 800px;
            border-radius: var(--radius-lg);
            position: relative;
        }
        #modalTitle {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        #modalScriptContent {
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: var(--radius-md);
            max-height: 50vh;
            overflow-y: scroll;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.9em;
            line-height: 1.4;
            border: 1px solid #333;
        }
        .btn {
            border: none;
            padding: 10px 15px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-secondary {
            background-color: #555;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #333;
        }
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px;
            border-radius: var(--radius-md);
            z-index: 1001;
            display: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            animation: fadeInOut 3s forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(20px); }
        }
        
        .remove-script-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            line-height: 25px;
            text-align: center;
            font-size: 0.8rem;
            z-index: 20;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Script Explorer</h1>
            <div class="tabs">
                <div class="tab active" data-tab="cloud">Cloud Scripts</div>
                <div class="tab" data-tab="saved">Saved Scripts</div>
            </div>
        </header>

        <div class="controls">
            <input type="text" id="searchInput" placeholder="Search scripts..." />
            <select id="scriptType">
                <option value="">All Types</option>
                <option value="executor">Executor</option>
                <option value="utility">Utility</option>
                <option value="visual">Visual</option>
            </select>
            <select id="sortBy">
                <option value="updated">Recently Updated</option>
                <option value="views">Most Viewed</option>
                <option value="likes">Most Liked</option>
            </select>
            <select id="maxResults">
                <option value="20">20 / Page</option>
                <option value="30">30 / Page</option>
                <option value="50">50 / Page</option>
            </select>
        </div>

        <div id="cloudScripts" class="content-section active">
            <div class="script-grid" id="scriptsContainer">
                </div>
            </div>

        <div id="savedScripts" class="content-section">
            <div class="script-grid" id="localScriptsGrid">
                </div>
        </div>
    </div>

    <div id="scriptModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Script Title</h2>
            <pre id="modalScriptContent"></pre>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="modalCopyButton" class="btn btn-primary" style="flex-grow: 1;"><i class="fas fa-copy"></i> Copy Script</button>
                <button id="saveScriptBtn" class="btn btn-secondary" style="flex-grow: 1;"><i class="fas fa-bookmark"></i> Save Script</button>
                <button id="modalClose" class="btn btn-secondary" style="background-color: #555;"><i class="fas fa-times"></i> Close</button>
            </div>
        </div>
    </div>

    <div id="notification" class="notification">
        <span>Message here</span>
    </div>

    <script>
        let scriptsData = [];
        let currentPage = 1;
        let totalPages = 1;
        let currentScriptIndex = -1;
        let currentScript = null;
        
        // TEN CAC PROXY CORS DE KHAC PHUC LOI KET NOI
        const PROXIES = [
            'https://corsproxy.io/?',
            'https://api.codetabs.com/v1/proxy/?quest=',
            // Them cac proxy khac neu hai cai tren van bi chan
        ];
        let currentTab = 'cloud';
        
        // ===================================
        // LOCAL STORAGE FUNCTIONS
        // ===================================

        function getLocalScripts() {
            const scripts = localStorage.getItem('savedScripts');
            return scripts ? JSON.parse(scripts) : [];
        }
        
        function saveLocalScript(script) {
            const scripts = getLocalScripts();
            
            const scriptToSave = {
                title: script.title || 'Untitled',
                script: script.script || '',
                image: script.image || null,
                game: script.game?.name || script.game || null, 
                date: script.updatedAt || new Date().toISOString()
            };

            if (!scripts.some(s => s.title === scriptToSave.title && s.script === scriptToSave.script)) {
                scripts.push(scriptToSave);
                localStorage.setItem('savedScripts', JSON.stringify(scripts));
                return true;
            }
            return false;
        }
        
        function removeLocalScript(index) {
            const scripts = getLocalScripts();
            scripts.splice(index, 1);
            localStorage.setItem('savedScripts', JSON.stringify(scripts));
            renderLocalScripts();
            return scripts;
        }
        
        function renderLocalScripts() {
            const container = document.getElementById('localScriptsGrid');
            const scripts = getLocalScripts();
            if (scripts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>No saved scripts</h3>
                        <p>Save scripts by clicking the bookmark icon in the script modal</p>
                    </div>
                `;
                return;
            }
            let html = '';
            scripts.forEach((script, index) => {
                const gameName = script.game && typeof script.game === 'object' ? script.game.name : script.game || 'No game specified';
                
                html += `
                    <div class="script-card" style="animation-delay: ${index * 0.05}s">
                        <button class="remove-script-btn" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="script-image-container">
                            <img
                                src="${script.image || 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMzAwIDE4MCI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIxODAiIGZpbGw9IiMzMzMzMzIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVlciIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2IwYjBiMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+Tm8gSW1hZ2U8L3RleHQ+PC9zdmc='}"
                                class="script-image"
                                onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMzAwIDE4MCI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIxODAiIGZpbGw9IiMzMzMzMzIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVlciIgZm9udC1zaXplPSIxNCIgZmlybG89IiNiMGIwYjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkltYWdlIEVycm9yPC90ZXh0Pjwvc3ZnPg=='"
                            >
                        </div>
                        <div class="script-content">
                            <h3 class="script-title" title="${script.title}">${script.title}</h3>
                            <p class="script-info">
                                <i class="fas fa-gamepad"></i>
                                ${gameName}
                            </p>
                            <div class="script-stats">
                                <div class="stat-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${script.date ? new Date(script.date).toLocaleDateString() : 'N/A'}</span>
                                </div>
                            </div>
                            <button class="btn btn-primary" data-index="${index}" data-local="true" style="width: 100%; margin-top: auto;">
                                <i class="fas fa-copy"></i>
                                Copy Script
                            </button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
            document.querySelectorAll('#localScriptsGrid .btn-primary').forEach(btn => {
                btn.addEventListener('click', handleLocalCopy);
            });
            document.querySelectorAll('.remove-script-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = btn.dataset.index;
                    removeLocalScript(index);
                    showMessage('Script removed from your collection');
                });
            });
            document.querySelectorAll('#localScriptsGrid .script-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON' || e.target.closest('button')) return;
                    const index = Array.from(card.parentElement.children).indexOf(card);
                    openScriptModal(index, true); 
                });
            });
        }
        
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.toggle('active', section.id === `${tab}Scripts`);
            });
            if (tab === 'saved') {
                renderLocalScripts();
            }
        }

        // ===================================
        // API FETCHING LOGIC (SUA LOI KET NOI VA DU LIEU)
        // ===================================
        
        async function fetchWithTimeout(url, timeout = 7000) {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(id);
                if (!response.ok) {
                    // Tra ve loi chi tiet hon neu HTTP status khong phai 200
                    throw new Error(`HTTP Error: ${response.status} ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                clearTimeout(id);
                throw error;
            }
        }
        
        async function loadScripts(search = '', page = 1) {
            const container = document.getElementById('scriptsContainer');
            container.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><h3>Loading scripts...</h3></div>';
            
            try {
                const scriptType = document.getElementById('scriptType').value;
                const sortBy = document.getElementById('sortBy').value;
                const maxResults = document.getElementById('maxResults').value;
                
                // LUON DUNG ENDPOINT SEARCH VA THAM SO Q RONG KHI KHONG TIM KIEM
                let apiUrl = new URL('https://scriptblox.com/api/script/search');
                
                apiUrl.searchParams.append('q', search.trim()); 
                
                apiUrl.searchParams.append('page', page);
                apiUrl.searchParams.append('max', maxResults);
                if (scriptType) apiUrl.searchParams.append('mode', scriptType);
                if (sortBy) apiUrl.searchParams.append('sortBy', sortBy);
                
                const finalApiUrl = apiUrl.toString();
                let data;
                let success = false;
                let lastError = null;

                // 1. Thu ket noi truc tiep (5 giay)
                try {
                    data = await fetchWithTimeout(finalApiUrl, 5000);
                    success = true;
                } catch (error) {
                    lastError = error;
                    console.log(`Direct fetch failed: ${error.message}. Trying proxies...`);
                }

                // 2. Thu tung Proxy CORS (10 giay cho moi proxy)
                if (!success) {
                    for (const proxyBaseUrl of PROXIES) {
                        try {
                            const proxyUrl = proxyBaseUrl + encodeURIComponent(finalApiUrl);
                            data = await fetchWithTimeout(proxyUrl, 10000); 
                            success = true;
                            break; 
                        } catch (error) {
                            lastError = error;
                            console.log(`Proxy ${proxyBaseUrl} failed: ${error.message}.`);
                        }
                    }
                }

                if (!success) {
                    throw new Error(`All connection methods failed. Last error: ${lastError ? lastError.message : 'Connection Refused'}`);
                }

                // === BAN VA MOI NHAT: XU LY CAU TRUC DU LIEU LINH HOAT ===
                
                scriptsData = [];
                totalPages = 1;
                // Uu tien result, sau do la data, cuoi cung la chinh doi tuong data
                let finalResult = data.result || data.data || data; 

                if (finalResult && typeof finalResult === 'object') {
                    if (Array.isArray(finalResult.scripts)) {
                        // Cau truc chuan: { result: { scripts: [...] } }
                        scriptsData = finalResult.scripts;
                        totalPages = finalResult.totalPages || 1;
                    } else if (Array.isArray(finalResult)) {
                        // Cau truc don gian: Mang scripts truc tiep
                        scriptsData = finalResult;
                    }
                } else if (Array.isArray(data)) {
                    // Truong hop dac biet: Mang scripts nam o tang ngoai cung cua doi tuong data
                    scriptsData = data;
                }
                
                currentPage = page;
                renderScripts();
                
            } catch (error) {
                console.error('Error fetching scripts:', error);
                showMessage(`Connection Error: ${error.message}`);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Failed to load scripts</h3>
                        <p>We couldn't connect to the server (CORS/Proxy error). Please check your internet connection or try refreshing.</p>
                        <p style="font-size: 0.7rem; margin-top: 10px;">Chi tiet: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // ===================================
        // RENDER FUNCTIONS
        // ===================================

        function renderScripts() {
            const container = document.getElementById('scriptsContainer');
            if (scriptsData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No scripts found</h3>
                        <p>Try adjusting your search or filters to find what you're looking for.</p>
                    </div>
                `;
                return;
            }
            let html = '';
            scriptsData.forEach((script, index) => {
                const raw = script.image;
                const imageUrl = raw
                    ? (raw.startsWith('http') ? raw : `https://scriptblox.com${raw}`)
                    : 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMzAwIDE4MCI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIxODAiIGZpbGw9IiMyNTI1MjUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVyIiBmb250LXNpemU9IjE0IiBmaWxsPSIjYjBiMGIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbm5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+Tm8gSW1hZ2U8L3RleHQ+PC9zdmc=';
                html += `
                    <div class="script-card" style="animation-delay: ${index * 0.05}s" data-index="${index}">
                        ${script.paid ? '<span class="script-badge">Premium</span>' : ''}
                        <div class="script-image-container">
                            <img
                                src="${imageUrl}"
                                class="script-image"
                                onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMzAwIDE4MCI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIxODAiIGZpbGw9IiMyNTI1MjUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVyIiBmb250LXNpemU9IjE0IiBmaWxsPSIjYjBiMGIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbm5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+SW1hZ2UgRXJyb3I8L3RleHQ+PC9zdmc='"
                            >
                        </div>
                        <div class="script-content">
                            <h3 class="script-title" title="${script.title}">${script.title}</h3>
                            <p class="script-info">
                                <i class="fas fa-gamepad"></i>
                                ${script.game?.name || 'No game specified'}
                            </p>
                            <div class="script-stats">
                                <div class="stat-item">
                                    <i class="fas fa-eye"></i>
                                    <span>${script.views?.toLocaleString() || 'N/A'}</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-thumbs-up"></i>
                                    <span>${script.likeCount?.toLocaleString() || 'N/A'}</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${script.updatedAt ? new Date(script.updatedAt).toLocaleDateString() : 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
            document.querySelectorAll('.script-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON' || e.target.closest('button')) return;
                    const index = card.dataset.index;
                    openScriptModal(index);
                });
            });
        }

        // ===================================
        // MODAL AND UI FUNCTIONS
        // ===================================

        function openScriptModal(index, isLocal = false) {
            let script;
            if (isLocal) {
                const scripts = getLocalScripts();
                script = scripts[index];
                currentScript = {...script, isLocal: true, localIndex: index};
            } else {
                script = scriptsData[index];
                currentScript = {...script, isLocal: false, index: index};
            }
            if (!script) return;
            const modal = document.getElementById('scriptModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalScriptContent');
            const saveScriptBtn = document.getElementById('saveScriptBtn');
            modalTitle.textContent = script.title;
            modalContent.textContent = script.script || 'No script content available'; 
            const scripts = getLocalScripts();
            const isSaved = scripts.some(s => s.title === script.title && s.script === script.script); 
            if (isSaved) {
                saveScriptBtn.innerHTML = '<i class="fas fa-check"></i> Saved';
                saveScriptBtn.classList.add('btn-success');
                saveScriptBtn.classList.remove('btn-secondary');
            } else {
                saveScriptBtn.innerHTML = '<i class="fas fa-bookmark"></i> Save Script';
                saveScriptBtn.classList.remove('btn-success');
                saveScriptBtn.classList.add('btn-secondary');
            }
            modal.classList.add('active');
        }
        
        function showMessage(message) {
            const notification = document.getElementById('notification');
            // Dat lai animation de thong bao co the xuat hien lai ngay lap tuc
            notification.style.animation = 'none';
            notification.offsetHeight; /* Trigger reflow */
            notification.style.animation = null; 

            notification.querySelector('span').textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function handleLocalCopy(event) {
            const button = event.currentTarget;
            const index = button.dataset.index;
            const scripts = getLocalScripts();
            const script = scripts[index];
            if (script && script.script) {
                navigator.clipboard.writeText(script.script)
                    .then(() => showMessage('Script copied!'))
                    .catch(err => console.error('Could not copy text: ', err));
            }
        }
        
        // ===================================
        // EVENT LISTENERS
        // ===================================
        
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const scriptType = document.getElementById('scriptType');
            const sortBy = document.getElementById('sortBy');
            const maxResults = document.getElementById('maxResults');
            const modal = document.getElementById('scriptModal');
            const modalClose = document.getElementById('modalClose');
            const modalCopyButton = document.getElementById('modalCopyButton');
            const saveScriptBtn = document.getElementById('saveScriptBtn');
            const tabs = document.querySelectorAll('.tab');
            
            // DEBOUNCE: Doi 700ms sau khi nguoi dung ngung go moi tim kiem
            searchInput.addEventListener('input', () => {
                clearTimeout(searchInput.timer);
                searchInput.timer = setTimeout(() => loadScripts(searchInput.value), 700);
            });
            
            scriptType.addEventListener('change', () => loadScripts(searchInput.value));
            sortBy.addEventListener('change', () => loadScripts(searchInput.value));
            maxResults.addEventListener('change', () => loadScripts(searchInput.value));
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            modalClose.addEventListener('click', () => {
                modal.classList.remove('active');
            });
            
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
            
            modalCopyButton.addEventListener('click', () => {
                if (currentScript && currentScript.script) {
                    navigator.clipboard.writeText(currentScript.script)
                        .then(() => showMessage('Script copied!'))
                        .catch(err => console.error('Could not copy text: ', err));
                }
            });
            
            saveScriptBtn.addEventListener('click', () => {
                if (currentScript) {
                    const success = saveLocalScript(currentScript);
                    if (success) {
                        showMessage('Script saved successfully!');
                        saveScriptBtn.innerHTML = '<i class="fas fa-check"></i> Saved';
                        saveScriptBtn.classList.add('btn-success');
                        saveScriptBtn.classList.remove('btn-secondary');
                    } else {
                        showMessage('Script is already in your collection.');
                    }
                }
            });
            
            // BAT DAU TAI DU LIEU KHI TRANG LOAD
            loadScripts();
        });
    </script>
</body>
</html>
